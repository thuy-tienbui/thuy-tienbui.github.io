{
  "hash": "70baa4d49fbdbcf0b9f5a197bb8eb6cc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Classifying plant species using binary logistic regression\"\ndescription: |\n  An analysis of palmetto species identification based on survival, growth, and biomass estimates\nauthor:\n  - name: Thuy-Tien Bui\ndate: 2025-02-14\ncategories: [R, Modeling]\nimage: palmetto.jpeg\nformat:\n  html:\n    embed-resources: true\n    code-fold: true\n    toc: false\n    page-layout: full\necho: true\nmessage: false\nwarning: false\n---\n\n\n\n### Dataset and Analysis Overview\n\nThe dataset analyzed in this study details survival, growth, and biomass estimates of two dominant palmetto species (Serenoa repens and Sabal etonia) of south-central Florida from 1981-2017. Height, canopy length and width (cm), and number of new and green leaves were measured annually from 1981-1997 and again from 2001-2017.\n\nThe purpose of this analysis is to use a binary logistic regression to test whether measurements of height, canopy length, canopy width, and number of green leaves can be used to determine the species of an unknown palmetto plant.\n\nData Citation: Abrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year intervals ver 1. Environmental Data Initiative.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(here)\nlibrary(cowplot)\nlibrary(patchwork)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(DiagrammeR)\n\n#create table outlining pseudocode\npseudo_df <- data.frame(\n  Steps = c(\"Read in and clean data\", \n                  \"Create boxplots to compare distribution of variables for each species\", \n                  \"Define two model formulas with different variable inclusions\", \n                  \"Fit models using ten fold cross validation\", \n                  \"Compare the models' predictive performance to select the best model\", \n                  \"Train the selected model on the entire dataset\",\n                  \"Obtain finalized parameter results\",\n                  \"Generate species predictions from best model\",\n                  \"Calculate prediction accuracy for each species\"))\n\npseudo_df %>% kable(\"html\", escape = FALSE) %>%\n  kable_styling(bootstrap_options = c(\"hover\")) %>%\n  pack_rows(\"1. Explore Data\", 1, 2) %>%\n  pack_rows(\"2. Compare binary logistic models\", 3, 5) %>%\n  pack_rows(\"3. Train the selected model\", 6, 7) %>% \n  pack_rows(\"4. Classification results\", 8, 9)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Steps </th>\n  </tr>\n </thead>\n<tbody>\n  <tr grouplength=\"2\"><td colspan=\"1\" style=\"border-bottom: 1px solid;\"><strong>1. Explore Data</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Read in and clean data </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Create boxplots to compare distribution of variables for each species </td>\n  </tr>\n  <tr grouplength=\"3\"><td colspan=\"1\" style=\"border-bottom: 1px solid;\"><strong>2. Compare binary logistic models</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Define two model formulas with different variable inclusions </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Fit models using ten fold cross validation </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Compare the models' predictive performance to select the best model </td>\n  </tr>\n  <tr grouplength=\"2\"><td colspan=\"1\" style=\"border-bottom: 1px solid;\"><strong>3. Train the selected model</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Train the selected model on the entire dataset </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Obtain finalized parameter results </td>\n  </tr>\n  <tr grouplength=\"2\"><td colspan=\"1\" style=\"border-bottom: 1px solid;\"><strong>4. Classification results</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Generate species predictions from best model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Calculate prediction accuracy for each species </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### Data Visualization\n\nI aim to assess whether height, width, length, and the number of green leaves can serve as effective variables for distinguishing between the two species. For these variables to be useful predictors, there should be clear and significant differences in their values between the species. To explore this, I will use boxplots, which provide a visual way to compare the distributions of these variables for each species and identify any noteworthy variations.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in dataset\npalmetto_df <- read_csv(here(\"data\", \"palmetto.csv\"))\n\n#remove unnecessary columns and change species data type to factor\npalmetto_clean <- palmetto_df %>% \n  select(species, height:green_lvs) %>% \n  mutate(species = as_factor(species)) %>% \n  drop_na()\n\n#explore the focal variables across the two species using boxplots\nheight_plot <- ggplot(palmetto_clean, aes(x = as_factor(species), y = height)) + \n  geom_boxplot(fill = \"#AEAC4C\", \n               color = \"#778F33\",\n               alpha = 0.7, \n               outlier.color = \"#E8851D\") +\n  scale_x_discrete(labels = c(\"1\" = \"Serenoa repens\", \"2\" = \"Sabal etonia\")) +\n  labs(x = \"\", y = \"Canopy Height (cm)\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(face = \"italic\")) + \n  theme(plot.margin = margin(20, 20, 20, 20))\n\nlength_plot <- ggplot(palmetto_clean, aes(x = as_factor(species), y=length)) +\n  geom_boxplot(fill = \"#AEAC4C\", \n               color = \"#778F33\",\n               alpha = 0.7, \n               outlier.color = \"#E8851D\") +\n  scale_x_discrete(labels = c(\"1\" = \"Serenoa repens\", \"2\" = \"Sabal etonia\")) +\n  labs(x = \"\", y = \"Canopy Length (cm)\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(face = \"italic\")) + \n  theme(plot.margin = margin(20, 20, 20, 20))\n\nwidth_plot <- ggplot(palmetto_clean, aes(x = as_factor(species), y=width)) +\n  geom_boxplot(fill = \"#AEAC4C\", \n               color = \"#778F33\",\n               alpha = 0.7, \n               outlier.color = \"#E8851D\") +\n  scale_x_discrete(labels = c(\"1\" = \"Serenoa repens\", \"2\" = \"Sabal etonia\")) +\n  labs(x = \"\", y = \"Canopy Width (cm)\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(face = \"italic\")) + \n  theme(plot.margin = margin(20, 20, 20, 20))\n\nleaves_plot <- ggplot(palmetto_clean, aes(x = as_factor(species), y=green_lvs)) +\n  geom_boxplot(fill = \"#AEAC4C\", \n               color = \"#778F33\",\n               alpha = 0.7, \n               outlier.color = \"#E8851D\") +\n  scale_x_discrete(labels = c(\"1\" = \"Serenoa repens\", \"2\" = \"Sabal etonia\")) +\n  labs(x = \"\", y = \"Count of Green Leaves\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(face = \"italic\")) + \n  theme(plot.margin = margin(20, 20, 20, 20))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#combine above plots in a single output panel format\n#| label: fig-variables\n#| fig-cap: \"Comparison of canopy height, canopy width, canopy length, and count of green leaves for *Serenoa repens* and *Sabal etonia.*\"\n\nplot_grid(height_plot, length_plot, width_plot, leaves_plot,\n          labels = c(\"A\", \"B\", \"C\", \"D\"),\n          ncol = 2,\n          label_x=0.01,\n          label_y = 0.98)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/combine plots-1.png){width=672}\n:::\n:::\n\n\n\n> The plant heights of the two species appear to be similar, suggesting that height may not be a strong predictor for species identification. However, there are noticeable differences in plant width, with greater distinctions in leaf length and the number of green leaves. Leaf length and the number of green leaves will be particularly significant predictors, as they appear to exhibit the most considerable variation between the species.\n\n### Binary Logistic Regression Models\n\nI compared two models: one that predicts species based on height, width, and green leaves, and one that predicts species based on height, width, green leaves, and length. I assessed model performance by repeatedly fitting the model to ten different subsets of the data (ten-fold cross validation) and evaluating the performance metrics.\n\n-   Model 1 - log odds of plant type using plant height, canopy length, canopy width and green leaves as predictor variables.\n\n-   Model 2 - Log odds of plant type using plant height, canopy width and green leaves as predictor variables.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define formulas\nf1 <- species ~ height  + width + green_lvs + length\nf2 <- species ~ height + width + green_lvs\n\n#create folds\nset.seed(123)\nfolds <- vfold_cv(palmetto_clean, v = 10, repeats = 10)\n\n#set up model\nblog_mdl <- logistic_reg() %>% \n  set_engine('glm')\n\n#create workflows\nblog_wf1 <- workflow() %>%\n  add_model(blog_mdl) %>% \n  add_formula(f1)\n\nblog_wf2 <- workflow() %>%\n  add_model(blog_mdl) %>% \n  add_formula(f2)\n\n#apply workflows to folded data\nblog_fit_folds1 <- blog_wf1 %>% \n  fit_resamples(folds)\n  \nblog_fit_folds2 <- blog_wf2 %>% \n  fit_resamples(folds)\n\n#cross validation results\ncollect_metrics(blog_fit_folds1) %>% \n  select(-.config) %>% \n  rename(metric = .metric,\n         estimator = .estimator,\n         standard_error = std_err) %>% \n  kbl() %>% \n  kable_styling(bootstrap_options = c(\"hover\"),\n                position = \"right\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover\" style=\"margin-right: 0; margin-left: auto\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> metric </th>\n   <th style=\"text-align:left;\"> estimator </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> standard_error </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> accuracy </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.9168175 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0007854 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> brier_class </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.0628770 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0004686 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> roc_auc </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.9724926 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0003756 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\ncollect_metrics(blog_fit_folds2) %>% \n  select(-.config) %>% \n  rename(metric = .metric,\n         estimator = .estimator,\n         standard_error = std_err) %>% \n  kbl() %>% \n  kable_styling(bootstrap_options = c(\"hover\"),\n                position = \"right\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover\" style=\"margin-right: 0; margin-left: auto\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> metric </th>\n   <th style=\"text-align:left;\"> estimator </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> standard_error </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> accuracy </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.8987528 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0009137 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> brier_class </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.0735265 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0004935 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> roc_auc </td>\n   <td style=\"text-align:left;\"> binary </td>\n   <td style=\"text-align:right;\"> 0.9634662 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:right;\"> 0.0004368 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n> Both models performed well based on their accuracy rates and area under the Receiver Operator Characteristic curve (ROC AUC). The cross validation results indicate model 1 (which includes length as a variable) is the best model for predicting species. This model had a greater ROC AUC and accuracy rate compared to model 2 (without length as a variable). Therefore, model 1 will be selected as the \"best\" model.\n\n### Training the selected model\n\nI trained model 1 on the entire dataset, without folding, to obtain the regression coefficients for each predictor variable.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#train model on entire dataset\nblog1_fit <- blog_mdl %>%\n  fit(formula = f1, data = palmetto_clean)\n\n#create a table of the results\nbroom::tidy(blog1_fit) %>% \n  select(-statistic) %>% \n  kbl() %>% \n  kable_styling(bootstrap_options = c(\"hover\"),\n                position = \"right\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover\" style=\"margin-right: 0; margin-left: auto\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 3.2266851 </td>\n   <td style=\"text-align:right;\"> 0.1420708 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> height </td>\n   <td style=\"text-align:right;\"> -0.0292173 </td>\n   <td style=\"text-align:right;\"> 0.0023061 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> width </td>\n   <td style=\"text-align:right;\"> 0.0394434 </td>\n   <td style=\"text-align:right;\"> 0.0021000 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> green_lvs </td>\n   <td style=\"text-align:right;\"> -1.9084747 </td>\n   <td style=\"text-align:right;\"> 0.0388634 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> length </td>\n   <td style=\"text-align:right;\"> 0.0458233 </td>\n   <td style=\"text-align:right;\"> 0.0018661 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### Evaluating the trained model\n\nI evaluated the predictive strength of the finalized model, I compared the predicted species classifications to the actual species classifications. The predictions were already made using a 50% cutoff in which a species was classified as species 1 or 2 if the modeled probability of it being either species was 50% or greater.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nblog1_predict <- palmetto_clean %>% \n  mutate(predict(blog1_fit, new_data = .)) %>% \n  mutate(predict(blog1_fit, new_data = ., type = 'prob'))\n\npredict_table <- table(blog1_predict %>%\n        select(species, .pred_class))\n```\n:::\n\n::: {#tbl-predictions .cell tbl-cap='Add figure caption'}\n\n```{.r .cell-code}\nkbl(data.frame(\n  species = c(\"1\", \"2\"),\n  n_correct = c(5548, 5701),\n  n_incorrect = c(564, 454)) %>% \n  mutate(p_correct = n_correct/(n_correct+n_incorrect))) %>%\n  kable_styling(bootstrap_options = c(\"hover\"),\n                position = \"right\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover\" style=\"margin-right: 0; margin-left: auto\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> species </th>\n   <th style=\"text-align:right;\"> n_correct </th>\n   <th style=\"text-align:right;\"> n_incorrect </th>\n   <th style=\"text-align:right;\"> p_correct </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 5548 </td>\n   <td style=\"text-align:right;\"> 564 </td>\n   <td style=\"text-align:right;\"> 0.9077225 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 5701 </td>\n   <td style=\"text-align:right;\"> 454 </td>\n   <td style=\"text-align:right;\"> 0.9262388 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n> Model 1 correctly classified palmetto as species 1 about 91% of the time and as species 2 93% of the time. The model is not completely precise, as some misclassifications still result, but it did demonstrate a high level of accuracy. The model's performance could be enhanced by adding stronger predictive variables that better capture the differences between the species.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}